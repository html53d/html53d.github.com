/*
* f3d				Presenting with style
* Author:			Valentin Stoyanov
* Date:				12-04-2012
* URL:				http://www.f3dslider.com/
* Version:			1.2
* 
* jQuery powered content slider featuring smooth 3D animation.
* Wordpress plugin is also available. Check it out here: www.f3dslider.com
* Wordpress plugin author: Stanil Dobrev
*/

(function(a,b){a.fn.f3d=function(c){if(c===b||c===null)c={};var d=a.extend({},a.fn.f3d.defaults,c);d.preimages=[];d.path="";a.fn.f3d.objects.push({cont:this,args:d});return this.each(function(b){var c=this;var e=a(c);d.$cont=e;e.css({position:"relative",overflow:"hidden"});if(d.sliderWidth)e.css({width:d.sliderWidth});if(d.sliderHeight)e.css({height:d.sliderHeight});if(d.useLogo)d.preimages.push(d.useLogo);if(d.useBackground){a.fn.f3d.get_add(d,"bg_active");a.fn.f3d.get_add(d,"bg_static")}var f=a(this).find("*:not(script)");var g=a('<div class="f3d_preloader f3d_added"></div>');e.append(g);g.css({position:"absolute",left:0,top:0,"z-index":99999,"background-color":"#111",width:a.fn.f3d.get_elem(c,"w")+"px",height:a.fn.f3d.get_elem(c,"h")+"px"});if(d.path==""){d.path=a.fn.f3d.get_url(g.css("background-image"));d.path=d.path.split("/");d.path.pop();d.path=d.path.join("/")+"/"}var h=a("<div></div>");h.css({width:"0px",height:"0px",overflow:"hidden"}).hide();e.append(h);d.$preloader=g;d.$preloader_hidden=h;var i=[];f.each(function(){var b="";if(a(this).css("background-image")!="none")b=a(this).css("background-image");else if(typeof a(this).attr("src")!="undefined"&&this.tagName.toLowerCase()=="img")b=a(this).attr("src");b=a.fn.f3d.get_url(b);if(b&&b.length>0)d.preimages.push(b)});d.loaded=0;d.total=d.preimages.length;d.ieTimeout=setTimeout(function(){j(d)},2e3);var j=function(a){var b=navigator.userAgent.match(/MSIE (\d+(?:\.\d+)+(?:b\d*)?)/);if(b&&b[0].match("MSIE")){while(100/a.total*a.loaded<100){k(a)}}};var k=function(b){b.loaded++;b.loader_status=Math.ceil(100/b.total)*b.loaded;if(b.loader_status>100)b.loader_status=100;b.$preloader.html(b.loader_status+"%");if(b.loaded==b.total){clearTimeout(b.ieTimeout);b.$preloader_hidden.remove();a.fn.f3d.init_container(c,b)}};for(var l=0;l<d.total;l++){var m=a("<img />");a(m).attr("src",d.preimages[l]);a(m).unbind("load");a(m).bind("load",function(){k(d)});a(m).appendTo(h)}})};a.fn.f3d.objects=[];a.fn.f3d.defaults={version:"1.2",autoStop:"nonstop",autoStart:true,hoverContainerStop:false,hoverStop:true,controlsHide:true,useReflection:true,useShadow:true,useBackground:true,useBackgroundText:true,useMouseX:true,useMouseY:true,activeSlides:true,dynamicColors:false,useControlPrev:true,useControlNext:true,useControlPlay:true,useControlColor:true,useControlPager:true,usePagerLabels:false,usePagerThumbs:true,useLogo:"",sliderWidth:"100%",sliderHeight:"",cameraExpose:5e3,cameraFocal:1e3,first:0,selector_slide:".f3d_slide",selector_media:".f3d_media",selector_details:".f3d_details",class_activeColor:"activeColor",class_activeSlide:"activeSlide",colors:["#000000","#610012","#1d1127","#522701","#082502","#101d28"],info:false};a.fn.f3d.clear_children=function(b){a(b).find(".f3d_added").each(function(){a(this).unbind().remove()});return false};a.fn.f3d.clear_container=function(b){$cont=a(b);$cont.unbind();var c=$cont.data("f3d.opts");if(c){a.fn.f3d.pause(c);if(c.controls){for(var d in c.controls){if(d=="Pager"||d=="Color"){a.fn.f3d.clear_children(c.controls[d])}else a(c.controls[d]).unbind()}}if(c.clickables)a.fn.f3d.clear_children(c.clickables);if(c.$shadow){a.fn.f3d.clear_children(c.$shadow);c.$shadow.remove()}a(b).find(".f3d_added").each(function(){a(this).remove()});for(var d in c.slides){a.fn.f3d.action(c,c.slides[d],c.camera,"reset");a.fn.f3d.action(c,c.slides[d],c.camera,"restore")}c.bg_active=null;c.bg_static=null}return false};a(window).resize(function(){a("body").find(".f3d_added").each(function(){a(this).remove()});for(var b in a.fn.f3d.objects)a.fn.f3d.init_container(a.fn.f3d.objects[b].cont,a.fn.f3d.objects[b].args)});a.fn.f3d.init_container=function(b,c){a.fn.f3d.clear_container(b);a.fn.f3d.init_scene(b,c);if(c===false)return;if(c.slides&&c.slides.length>0){for(var d in c.slides){var e=c.slides[d];a.fn.f3d.action(c,e,c.camera,"init");a.fn.f3d.action(c,e,c.camera,"reset");if(d!=c.first&&c.activeSlides){a.fn.f3d.make_clickable(c,d)}a.fn.f3d.render_slide(c,e,c.camera)}a.fn.f3d.reorder_slides(c);if(c.info){a.fn.f3d.get_add(c,"info")}if(c.autoStart)a.fn.f3d.goto(c,c.first);a.fn.f3d.update_controls(c);a.fn.f3d.change_color(c,c.color_index)}if(c.$preloader){c.$preloader.fadeTo("slow",0,function(){a(this).remove()})}if(c.useVersion){a.fn.f3d.get_add(c,"version")}};a.fn.f3d.init_scene=function(c,d){var e=a(c);var f=e.find(d.selector_slide);var g=f.get();var h={};if(g.length<2)return;e.data("f3d.opts",d);d.$cont=e;d.elements=g;d.camera=h;d.slides=null;d.clickables=null;d.total_slides=g.length;d.drive_id=0;d.cont_w=a.fn.f3d.get_elem(c,"w");d.cont_h=a.fn.f3d.get_elem(c,"h");d.cont_x=a.fn.f3d.get_elem(c,"x");d.cont_y=a.fn.f3d.get_elem(c,"y");d.cont_cx=d.cont_x+Math.ceil(d.cont_w/2);d.cont_cy=d.cont_y+Math.ceil(d.cont_h/2);d.bg_active_w=0;d.bg_active_h=0;d.controls_w=0;d.controls_h=0;d.autoStop=d.autoStop.toLowerCase();d.first=parseInt(d.first,10)-1;if(d.first<0)d.first=0;else if(d.first>=d.total_slides)d.first=d.total_slides-1;h.focal=parseInt(d.cameraFocal,10);h.expose=parseInt(d.cameraExpose,10);h.speed_max=200;h.speed=0;h.mouse_coef_x=1/4;h.mouse_coef_y=1/4;h.speed_min=2;h.friction_max=.9;h.friction=h.friction_max;h.dir=1;h.dir_change=1;h.fps=30;h.x_delta=Math.ceil(d.cont_w/2);h.z_min=Math.ceil(d.cont_h/4);h.stopp=Math.ceil(a.fn.f3d.get_distance(d,h.speed_max,h.friction_max));h.slide_distance=Math.ceil(h.stopp+h.z_min);h.x=d.cont_cx;h.y=-Math.ceil(d.cont_h/4);h.z=0;h.z_max=d.total_slides*h.slide_distance;h.x_mouse=0;h.y_mouse=0;h.status="";d.curr=-1;d.fade_far=.5;d.cont_margin=10;d.img_margin=20;d.shadow_h=50;d.shadow_w=70;d.color_index=0;d.t=1e3;d.d=1/5;d.e="easeOutExpo";d.paused=!d.autoStart;d.paused_previous=d.paused;d.stopped=d.paused;d.justClicked=false;if(!a.support.opacity)a.fn.f3d.type_fix(f);if(d.useBackground){if(d.bg_active==b||d.bg_active==null)a.fn.f3d.get_add(d,"bg_active");if(d.bg_static==b||d.bg_static==null)a.fn.f3d.get_add(d,"bg_static");d.bg_active_w=a.fn.f3d.get_elem(d.bg_active,"w");d.bg_active_h=a.fn.f3d.get_elem(d.bg_active,"h");a.fn.f3d.bg_move(d);if(d.useMouseX||d.useMouseY){e.mousemove(function(b){if(d.useMouseX){h.x_mouse=Math.ceil(d.cont_cx-b.pageX)*h.mouse_coef_x}if(d.useMouseY){h.y_mouse=Math.ceil(d.cont_cy-b.pageY)*h.mouse_coef_y;if(d.bg_active)a.fn.f3d.bg_move(d)}if(d.paused){for(var c=0;c<d.total_slides;c++){a.fn.f3d.render_slide(d,d.slides[c],d.camera)}}})}}a.fn.f3d.get_add(d,"bg_top");a.fn.f3d.get_add(d,"shadow");if(d.activeSlides){a.fn.f3d.get_add(d,"clickables")}if(d.useLogo){a.fn.f3d.get_add(d,"logo")}var i=function(b){a(b).fadeTo("fast",.3)};var j=function(b){a(b).fadeTo("fast",1)};d.slides=[];var k=1;var l=-1;var m=d.first;f.each(function(c){var e=a(this);e.css({position:"absolute",overflow:"hidden",left:0,top:0,width:d.cont_w+"px",height:d.cont_h+"px","z-index":d.total_slides-o});k*=-1;l++;if(l>=d.colors.length)l=0;var f={num:c,x:Math.ceil(d.cont_cx+d.cont_w/2*k),y:0,z:(c+1)*h.slide_distance,opacity:1,slide_w:a.fn.f3d.get_elem(this,"w"),slide_h:a.fn.f3d.get_elem(this,"h"),slide_x:a.fn.f3d.get_elem(this,"x"),slide_y:a.fn.f3d.get_elem(this,"y"),details:null,img:null,each:[],status:""};var g=e.find(d.selector_details+":first");var i=e.find(d.selector_media+":first");if(!i||i.length==0)i=null;if(!g||g.length==0)g=null;if(i){i.css({position:"absolute",overflow:"hidden",top:0,left:0});var j=i.find("[src]:first");var m=null;if(j.length==0)j=null;if(j){j.unreflect();f.refl=null;if(d.useReflection&&j.is("img")){j.reflect({height:1/2,opacity:.3});m=j.parent().children(":last");f.refl=m[0]}if(f.shadow)a(f.shadow).remove();f.shadow=null;if(d.useShadow){var n=a.fn.f3d.get_shadow(d);e.append(n);f.shadow=n[0]}f.img=j[0];f.img_w=a.fn.f3d.get_elem(f.img,"w");f.img_h=a.fn.f3d.get_elem(f.img,"h");f.img_x=a.fn.f3d.get_elem(f.img,"x");f.img_y=a.fn.f3d.get_elem(f.img,"y");f.img_ratio=f.img_w/f.img_h}f.media=i[0]}if(g){g.css({position:"absolute",overflow:"hidden",top:0,left:0});f.details=g[0];f.details_w=a.fn.f3d.get_elem(f.details,"w");f.details_h=a.fn.f3d.get_elem(f.details,"h");f.details_x=a.fn.f3d.get_elem(f.details,"x");f.details_y=a.fn.f3d.get_elem(f.details,"y");g.css({overflow:"visible"});g.children().each(function(b){var c=a(this);c.css({position:"relative"});var d=a.fn.f3d.get_elem(this,"all");var e=b%2==0?"+":"-";d.invisible={opacity:0,left:e+"200"};d.visible={opacity:1,left:0};f.each.push(d);return true})}var o=c;if(d.first!=0){if(c==d.first)o=0;else if(c>d.first)o=c-d.first;else o=d.total_slides-d.first+c;f.z=(o+1)*h.slide_distance}f.slide=e[0];f.z_offset=o;f.distance=f.z;f.expose=h.expose;var p=null;var q=null;f.color_index=l;f.color=d.colors[l];var r=d["slide_"+(c+1)];if(r){if(r.expose)f.expose=parseInt(r.expose,10);if(r.color&&r.color!="auto"){f.color=r.color;var s=-1;var t=0;while(s<0&&t<d.colors.length){if(d.colors[t]==r.color){s=t}t++}if(s>=0){f.color_index=s}else{d.colors.push(r.color);f.color_index=d.colors.length-1}}p=r.vert;q=r.horz}f.details_vert="below";f.details_horz=k>0?"right":"left";if(p==b||p==null||p=="auto")p=null;if(q==b||q==null||q=="auto")q=null;if(!p||!q){if(f.img_w<=f.img_h||f.img_ratio<2){if(!p)p="top";if(!q)q=k>0?"leftOutside":"rightOutside"}else{if(!p)p="below";if(!q)q=k>0?"right":"left"}}f.details_vert=p;f.details_horz=q;if(c==d.first){f.x=h.x;d.color_index=f.color_index;d.color=f.color}if(d.activeSlides&&d.$clickables!=b){var u=a("<div></div>");u.css({position:"absolute",display:"none",border:"2px solid #ffcb05","box-shadow":"0px 0px 50px rgba(255, 255, 255, 1)"});d.$clickables.append(u);f.clickable_active=true;u.bind("mouseenter",function(){if(!d.justClicked){a(this).stop(true).fadeTo(0,1).animate({backgroundColor:"white"},50).animate({backgroundColor:"transparent"},300);if(f.z>=d.camera.z)e.fadeTo(0,1);if(d.$curr&&parseInt(d.$curr.css("opacity"))!=.5)d.$curr.stop().fadeTo(0,.5);if(d.hoverStop)a.fn.f3d.pause(d)}return false});u.bind("mouseleave",function(){if(a(this).css("display")!="none")a(this).stop(true).fadeTo("fast",0);if(f.z>=d.camera.z)if(f.status=="")e.fadeTo(0,d.fade_far);if(d.paused&&!d.paused_previous)a.fn.f3d.start(d);if(d.$curr)d.$curr.fadeTo("fast",1);return false});u.bind("click",function(){d.camera.dir=1;d.justClicked=true;a.fn.f3d.goto(d,f.num,d.curr);return false});f.clickable=u[0]}d.slides.push(f);return true});d.controls={Pager:null,Prev:null,Next:null,Play:null,Color:null};var n=null;var o=null;for(var p in d.controls){c_lowercase=p.toLowerCase();if(d["useControl"+p]){if(n==null){n=a('<ul class="f3d_controls f3d_added"></ul>');e.append(n)}var q=a('<li id="f3d_'+c_lowercase+'"></li>');n.append(q);d.controls[p]=q[0];if(c_lowercase=="color"){for(var r in d.colors){o=a('<span class="f3d_added" style="background-color:'+d.colors[r]+'"></span>');q.append(o);o.stop().bind("click",{color_index:r},function(b){a.fn.f3d.change_color(d,b.data.color_index)});o.hover(function(){i(this)},function(){j(this)})}}else if(c_lowercase=="pager"){var s=null;var t=null;var u=null;d.thumbs=[];d.curr_thumb=-1;if(d.usePagerThumbs){s=a('<div class="f3d_added f3d_thumb"><div></div></div>');t=s.children(":last");e.append(s);d.tool_w=a.fn.f3d.get_elem(s,"w");d.tool_h=a.fn.f3d.get_elem(s,"h");d.toolimg_w=a.fn.f3d.get_elem(t,"w");d.toolimg_h=a.fn.f3d.get_elem(t,"h");s.css({display:"block","z-index":9999+d.total_slides,left:a.fn.f3d.get_elem(q[0],"x")+"px",top:d.cont_h-d.tool_h-35+"px"}).hide();d.tooltip=s;d.toolimg=t;q.mouseenter(function(){d.tooltip_active=true;s.fadeTo("fast",1)});q.mouseleave(function(){d.tooltip_active=false;s.fadeTo("fast",0)});q.mousemove(function(a){var b=a.pageX-d.cont_x-d.tool_w/2;d.tooltip.css({left:b})})}for(var r in d.slides){u=d.usePagerLabels?parseInt(r)+1:"";o=a('<span class="f3d_added">'+u+"</span>");q.append(o);if(d.usePagerThumbs)a.fn.f3d.thumb_load(d,d.slides[r],r);o.stop().bind("click",function(b){var c=a(this).index();if(d.curr!=c){if(c>d.curr)d.camera.dir=1;else d.camera.dir=-1;a.fn.f3d.goto(d,c,d.curr)}});o.hover(function(){i(this);if(d.thumbs.length>0){var b=a(this).index();if(d.curr_thumb!=b){if(d.curr_thumb>=0){d.thumbs[d.curr_thumb].animate({left:-d.slides[d.curr_thumb].thumb_w+"px"},"fast").hide()}d.thumbs[b].css({top:0,left:d.toolimg_w+"px"}).show().animate({left:"0px"},"fast");d.curr_thumb=b}}},function(){j(this)})}}else{q.stop().bind("click",{control_opts:d,control_id:c_lowercase},function(b){var c=b.data.control_id;var d=b.data.control_opts;switch(c){case"prev":case"next":if(c=="next")h.dir=1;else h.dir=-1;a.fn.f3d.goto(d,c,d.curr);break;case"play":if(d.stopped){a.fn.f3d.goto(d,"next",d.curr)}else if(d.paused)a.fn.f3d.start(d);else a.fn.f3d.pause(d);a.fn.f3d.update_controls(d);break}});q.hover(function(){i(this)},function(){j(this)})}}}if(n!=b&&n!=null){n.css({"z-index":9999+d.total_slides*2});d.$controls=n;d.controls_w=a.fn.f3d.get_elem(n[0],"w");d.controls_h=a.fn.f3d.get_elem(n[0],"h");if(d.controlsHide){d.cont_hover=false;n.hide()}}e.mouseenter(function(b){d.cont_hover=true;if(d.controlsHide&&d.$controls)d.$controls.fadeTo("fast",1);if(d.hoverContainerStop){a.fn.f3d.pause(d);a.fn.f3d.update_controls(d)}});e.mouseleave(function(b){d.cont_hover=false;if(d.controlsHide&&d.$controls)d.$controls.fadeTo("slow",0);if(d.hoverContainerStop){a.fn.f3d.start(d);a.fn.f3d.update_controls(d)}})};a.fn.f3d.pause=function(a){clearTimeout(a.drive_id);a.drive_id=-1;a.paused_previous=a.paused;a.paused=true};a.fn.f3d.start=function(b){clearTimeout(b.drive_id);b.paused=false;if(b.stopped){b.stopped=false;a.fn.f3d.goto(b,b.curr)}else b.drive_id=setTimeout(function(){a.fn.f3d.drive(b,b.camera)},b.camera.fps)};a.fn.f3d.make_clickable=function(b,c){var d=b.slides[c];var e=a(d.clickable);if(e){e.stop().show().fadeTo(0,0).css({cursor:"pointer"}).attr("disabled",false);d.clickable_active=true}};a.fn.f3d.remove_clickable=function(b,c){var d=b.slides[c];var e=a(d.clickable);if(e){e.stop().hide().attr("disabled",true);d.clickable_active=false}};a.fn.f3d.change_color=function(b,c){if(b.controls.Color){a(b.controls.Color).children().removeClass(b.class_activeColor).eq(c).addClass(b.class_activeColor)}b.color_index=c;b.color=b.colors[c];b.$cont.stop().animate({backgroundColor:b.color},500)};a.fn.f3d.update_controls=function(b){if(b.controls){var c=a(b.controls["Play"]);var d=a(b.controls["Pager"]);var e=a(b.controls["Color"]);var f="";if(c.length>0){if(b.paused)f="f3d_play";else f="f3d_pause";c.attr("id",f)}if(d.length>0){d.children().removeClass(b.class_activeSlide).eq(b.curr).addClass(b.class_activeSlide)}}};a.fn.f3d.reorder_slides=function(b,c){var d=a.fn.f3d.get_what(b,null,"z_max").num;var e,f,g;for(var h=1;h<=b.total_slides;h++){f=a(b.slides[d].slide);g=a(b.slides[d].clickable);if(b.slides[d].status=="waiting")e=0;else e=h;f.css("z-index",e);if(g){if(d==b.curr)g.css("z-index",0);else g.css("z-index",e+b.total_slides+1);b.slides[d].clickable_z_index=g.css("z-index")}b.slides[d].z_index=e;d-=1;if(d<0)d=b.total_slides-1;else if(d==b.total_slides)d=0}};a.fn.f3d.render_slide=function(b,c,d){var e=a(c.slide);var f=a(c.media);var g=a(c.details);var h=a(c.clickable);var i=a(c.img);var j=a(c.refl);var k=a(c.shadow);if(c.z>=b.camera.z||c.status.indexOf("fadeout")>=0){var l=c.x-(d.x-d.x_mouse);var m=c.y-(d.y-d.y_mouse);var n=c.z-d.z;var o=Math.abs(d.focal/(d.focal+n));var p=Math.ceil(c.img_w*o);var q=Math.ceil(c.img_h*o);var r=Math.ceil((b.cont_w-p)/2+l*o-d.x_mouse);var s=Math.ceil((b.cont_h-q)/2+m*o+d.y-d.y_mouse);c.scale=o;c.scale_w=p;c.scale_h=q;c.x_pos=r;c.y_pos=s;i.css({width:p+"px",height:q+"px"});if(j)j.css({width:p+"px",height:q+"px"});if(f)f.css({width:p+"px",height:2*q+"px",left:r+"px",top:s+"px"});if(k){var t=null;var u=0;var v=b.shadow_h;var w;k.children().each(function(c){w=c==1?p:b.shadow_w;v=b.shadow_h;if(o<1){if(c!=1)w=Math.ceil(w*o);v=Math.ceil(b.shadow_h*o)}if(t==null)t=w;a(this).css({width:w+"px",height:v+"px",left:u+"px",top:0});u+=w;return true});k.css({left:r-t+"px",top:s+q-v/2+"px",width:p+2*t+"px",height:v+"px"})}if(h&&c.clickable_active)h.css({width:p-2+"px",height:q-2+"px",left:r+"px",top:s+"px"});if(b.curr==c.num)a.fn.f3d.action(b,c,d,"frame")}};a.fn.f3d.need_fadeout=function(a,b,c){if(b.status.indexOf("fadeout")>=0)return false;if(b.num!=a.curr&&c.dir>0&&b.z<c.z)return true;if(c.dir<0&&b.z>c.z+c.z_max)return true;return false};a.fn.f3d.drive=function(b,c){var d=a.fn.f3d.get_what(b,b.curr,"obj");var e=a.fn.f3d.get_what(b,b.prev,"obj");var f=a.fn.f3d.get_what(b,b.next,"obj");var g=a.fn.f3d.get_what(b,b.curr,"camera_next");var h=a.fn.f3d.get_what(b,b.curr,"distance_signed");var i=null;if(c.status!="slowing"){if(c.dir>0&&h<=c.stopp&&h>c.z_min||c.dir<0&&d.status=="waiting"&&e.z-d.z>=c.slide_distance){d.status="show";c.status="slowing";a(d.slide).fadeTo(0,1);if(c.dir<0){a.fn.f3d.reorder_slides(b);d.timer=d.expose*3}else{d.timer=d.expose}}}if(d.timer>0){d.timer-=c.fps}if(c.status=="slowing"){c.speed*=c.friction;if(c.speed<c.speed_min)c.speed=c.speed_min;if(c.dir>0&&d.z<=c.z+c.z_min&&c.dir_change>0){c.dir_change=-1}else if(c.dir<0&&c.speed<=c.speed_min&&c.dir_change>0){c.dir_change=-1;d.timer=d.expose;c.friction=c.friction_max}}c.z=a.fn.f3d.get_what(b,b.curr,"camera_next");if(c.dir>0&&c.z>d.z)c.z=d.z;if(b.useMouseX&&!b.cont_hover&&c.x_mouse!=0){c.x_mouse*=c.friction;if(Math.abs(c.x_mouse)<=1)c.x_mouse=0}if(b.useMouseY&&!b.cont_hover&&c.y_mouse!=0){c.y_mouse*=c.friction;if(Math.abs(c.y_mouse)<=1)c.y_mouse=0;if(b.bg_active)a.fn.f3d.bg_move(b)}if(Math.abs(d.x-c.x)>1&&c.speed!=0){var j,k;if(d.status=="waiting")j=Math.abs(e.z-c.z)/c.speed;else j=Math.abs(d.z-c.z)/c.speed;k=Math.ceil(d.x-c.x);if(j>1){k=Math.ceil(k/j);c.x+=k}}for(var l=0;l<b.total_slides;l++){var m=b.slides[l];switch(m.status){case"show":b.justClicked=false;a.fn.f3d.action(b,m,c,"show");break;case"hide":m.timer=-1;m.shownonce=true;switch(b.autoStop){case"nonstop":a.fn.f3d.action(b,m,c,"hide");break;case"single":b.stopped=true;a.fn.f3d.pause(b);a.fn.f3d.update_controls(b);break;case"allonce":var n=0;var o=true;while(o&&n<b.total_slides){if(!b.slides[n].shownonce)o=false;n++}if(o){b.stopped=true;a.fn.f3d.pause(b);a.fn.f3d.update_controls(b)}else{a.fn.f3d.action(b,m,c,"hide")}break}break;case"waiting":if(c.dir>0){m.status="";a.fn.f3d.action(b,m,c,"reposition");a.fn.f3d.action(b,m,c,"fadein")}else{if(a.fn.f3d.get_prev(b,m.num,"z")-m.z>=c.slide_distance){a.fn.f3d.action(b,m,c,"fadein")}else m.z=a.fn.f3d.get_what(b,m.num,"waiting")}break;case"expose":if(m.timer<=0){m.status="hide"}break;case"expose_completed":i=f.num;m.status="";if(c.dir<0){a.fn.f3d.make_clickable(b,m.num);a(m.slide).fadeTo(0,b.fade_far)}break}if(a.fn.f3d.need_fadeout(b,m,c))a.fn.f3d.action(b,m,c,"fadeout");a.fn.f3d.render_slide(b,m,c);if(b.activeSlides&&m.num!=d.num){if(!m.clickable_active&&m.z>=c.z+c.slide_distance)a.fn.f3d.make_clickable(b,m.num);else if(m.clickable_active&&m.z<c.z+c.slide_distance)a.fn.f3d.remove_clickable(b,m.num)}}if(b.info)a.fn.f3d.update_info(b);if(!b.paused){if(i!=null)a.fn.f3d.goto(b,i);else b.drive_id=setTimeout(function(){a.fn.f3d.drive(b,b.camera)},b.camera.fps)}};a.fn.f3d.goto=function(c,d,e){var f=c.camera;if(d==b||d==null||typeof d=="string"){if(d=="prev")d=c.curr-1;else d=c.curr+1}if(d<0)d=c.total_slides-1;else if(d>=c.total_slides)d=0;c.stopped=false;c.paused=false;if(d!=c.curr){clearTimeout(c.drive_id);c.curr=d;c.prev=a.fn.f3d.get_prev(c,c.curr,"num");c.next=a.fn.f3d.get_next(c,c.curr,"num");c.$curr=a.fn.f3d.get_what(c,c.curr,"slide");c.$prev=a.fn.f3d.get_what(c,c.prev,"slide");c.$next=a.fn.f3d.get_what(c,c.next,"slide");f.speed=f.speed_max;f.status="";f.dir_change=1;if(f.dir>0){f.friction=f.friction_max}else{f.friction=f.friction_max-.1}f.friction=a.fn.f3d.get_friction(c,a.fn.f3d.get_what(c,c.curr,"distance_signed"),f.speed,f.friction,f.stopp);a.fn.f3d.remove_clickable(c,c.curr);if(e!=b&&e!=null&&e!=d&&e>=0){var g=a.fn.f3d.get_what(c,e,"obj");g.timer=-1;if(g.status.indexOf("fadeout")<0){a.fn.f3d.action(c,g,f,"reset");if(f.dir<0){a(g.slide).fadeTo(0,c.fade_far)}}}if(c.dynamicColors)a.fn.f3d.change_color(c,c.slides[c.curr].color_index);a.fn.f3d.start(c);a.fn.f3d.update_controls(c)}};a.fn.f3d.action=function(b,c,d,e){var f=c.num;var g=a(c.slide);var h=a(c.media);var i=a(c.details);var j=a(c.shadow);switch(e){case"restore":{if(h){if(a(c.shadow))a(c.shadow).remove();if(a(c.img)){a(c.img).unreflect();a(c.img).stop(true).show().css({width:c.img_w+"px",height:c.img_h+"px",left:c.img_x+"px",top:c.img_y+"px"})}h.stop(true).show().css({width:c.media_w+"px",height:c.media_h+"px",left:c.media_x+"px",top:c.media_y+"px"})}};case"init":if(j)j.css({"z-index":1});if(h)h.css({"z-index":2});if(i){var k;i.hide();switch(c.details_horz){case"rightOutside":k="left";break;case"leftOutside":k="right";break;default:k=c.details_horz;break}i.css({"z-index":3,overflow:"visible","text-align":k})}break;case"reset":c.status="";c.timer=-1;if(i){i.hide();i.children().each(function(b){a(this).stop(true).css({opacity:0});return true})}break;case"frame":if(i){var l=c.details_vert;var m=c.details_horz;var n=null;var o=null;var p=a.fn.f3d.get_elem(c.details,"w");var q=a.fn.f3d.get_elem(c.details,"h");switch(l){case"above":o=c.y_pos-q;if(o<b.cont_y+b.cont_margin)o=b.cont_y+b.cont_margin;break;case"top":o=c.y_pos;if(m!="leftOutside"&&m!="rightOutside"){o+=b.img_margin*c.scale}break;case"center":o=c.y_pos+(c.scale_h-q)/2;break;case"bottom":o=c.y_pos+c.scale_h-q;if(m!="leftOutside"&&m!="rightOutside"){o-=b.img_margin*c.scale}break;case"below":o=c.y_pos+c.scale_h+b.img_margin;if(o>b.cont_h-b.cont_margin-q-b.controls_h){o=b.cont_h-b.cont_margin-q-b.controls_h}break}switch(m){case"left":n=c.x_pos;if(l!="above"&&l!="below"){n+=b.img_margin*c.scale}break;case"right":n=c.x_pos+c.scale_w-p;if(l!="above"&&l!="below"){n-=b.img_margin*c.scale}break;case"center":n=c.x_pos+(c.scale_w-p)/2;break;case"rightOutside":n=c.x_pos+c.scale_w+b.img_margin;break;case"leftOutside":n=c.x_pos-b.img_margin-p;break}b.step_x=Math.abs(parseInt(i.css("left"),10)-n);b.step_y=Math.abs(parseInt(i.css("top"),10)-o);if(b.step_x>=.5)i.css({left:n+"px"});if(b.step_y>=.5)i.css({top:o+"px"})}break;case"show":case"hide":c.status=e+"_start";var r=0;var s=i.children().length;if(e=="show"){g.show();i.show()}i.children().each(function(d){if(e=="show"){r=d*b.t*b.d;a(this).stop().animate(c.each[d].invisible,0).delay(r).animate(c.each[d].visible,b.t,b.e,function(){if(d==s-1){c.status="expose"}})}else{r=(s-1-d)*b.t*b.d/2;a(this).delay(r).animate(c.each[d].invisible,b.t/2,b.e,function(){if(d==s-1)c.status="expose_completed"})}return true});break;case"fadein":var t=c.num==b.curr?1:b.fade_far;g.fadeTo("fast",t,function(){if(c.num!=b.curr)a.fn.f3d.make_clickable(b,c.num);if(d.dir<0)a.fn.f3d.reorder_slides(b,c.num);c.status=""});break;case"fadeout":c.status=e+"_start";g.fadeTo("fast",0,function(){if(d.dir>0){a.fn.f3d.action(b,c,d,"reposition");a.fn.f3d.action(b,c,d,"fadein")}else{c.status="waiting";a.fn.f3d.action(b,c,d,"reposition")}});break;case"reposition":if(d.dir>0){c.z=a.fn.f3d.get_prev(b,c.num,"z")+d.slide_distance;a.fn.f3d.reorder_slides(b)}else{c.z=a.fn.f3d.get_what(b,c.num,"waiting");a.fn.f3d.reorder_slides(b,c.num)}break}};a.fn.f3d.update_info=function(b,c){if(b.info){if(c)b.info.html(c);else{var d=b.slides[b.curr];var e=b.camera;var f=Math.ceil(a.fn.f3d.get_what(b,b.curr,"distance_signed"));var g=new Array;g.push("CURRENT: "+b.curr+", prev: "+b.prev+", next: "+b.next);g.push("x: "+d.x+", y: "+d.y+", z: "+d.z);g.push("scale: "+Math.ceil(d.scale*100)+"%");g.push("Timer: "+d.timer);g.push("Status: "+d.status);g.push("Coords w: "+d.scale_w+", h: "+d.scale_h+", x: "+d.x_pos+", y: "+d.y_pos);g.push("Details w: "+d.details_w+", h: "+d.details_h+", x: "+d.details_x+", y: "+d.details_y);g.push("=====================================");g.push("DISTANCE: "+f);g.push("slide: "+e.slide_distance+", stopp: "+e.stopp);g.push("=====================================");g.push("CAMERA: x: "+e.x+", z: "+e.z);g.push("Step x: "+b.step_x+", y: "+b.step_y);g.push("Mouse: x: "+e.x_mouse+", y: "+e.y_mouse);g.push("Speed: "+Math.ceil(e.speed));g.push("Friction: "+e.friction);g.push("Status: "+e.status);g.push("=====================================");var h=[];var i="";for(var j in b.slides){var k=b.slides[j];if(j>0)h.push(Math.abs(b.slides[j].z-b.slides[j-1].z));i=a(k.img).attr("src").split("/");i=i[i.length-1];g.push(j+". "+i+", d: "+a.fn.f3d.get_what(b,j,"distance_signed")+", s: "+Math.ceil(k.scale*100)+"%, z: "+a(k.slide).css("z-index")+", status: "+k.status)}b.info.html(g.join("<br/>"))}}};a.fn.f3d.type_fix=function(a){var b=function(a){a=parseInt(a,10).toString(16);return a.length<2?"0"+a:a};var c=function(a){for(;a&&a.nodeName.toLowerCase()!="html";a=a.parentNode){var c=jQuery.css(a,"background-color");if(c&&c.indexOf("rgb")>=0){var d=c.match(/\d+/g);return"#"+b(d[0])+b(d[1])+b(d[2])}if(c&&c!="transparent")return c}return"#ffffff"};a.each(function(){jQuery(this).css("background-color",c(this))})};a.fn.f3d.get_percent=function(a,b){if(a==0)return 0;else return Math.ceil(a*100/b)};a.fn.f3d.bg_move=function(b){if(b.bg_active){var c=b.cont_y+(b.cont_h-b.bg_active_h)/2+(b.camera.y-b.camera.y_mouse);a(b.bg_active).css({"background-position":"center "+c+"px"})}};a.fn.f3d.get_elem=function(b,c){switch(c){case"x":case"y":var d=a(b).position();if(c=="x"&&d.left)d=parseInt(d.left,10);else if(c=="y"&&d.top)d=parseInt(d.top,10);else d=0;return d;break;case"w":var d=a(b).innerWidth()||b.offsetWidth||b.width||a(b).attr("width")||0;return d;break;case"h":var d=a(b).innerHeight()||b.offsetHeight||b.height||a(b).attr("height")||0;return d;break;default:var d=null;if(a(b).length>0&&b.nodeType==1||b.nodeType==3){d={};d.el=b;d.num=a(b).index();d.w=a.fn.f3d.get_elem(b,"w");d.h=a.fn.f3d.get_elem(b,"h");d.x=a.fn.f3d.get_elem(b,"x");d.y=a.fn.f3d.get_elem(b,"y")}return d;break}};a.fn.f3d.get_friction=function(b,c,d,e,f){var g=e;var h=a.fn.f3d.get_distance(b,d,g);if(c<0){c=Math.abs(c);f+=c}var i=0;while(i<100&&h>f){i++;g-=.01;h=a.fn.f3d.get_distance(b,d,g)}return g};a.fn.f3d.get_distance=function(c,d,e,f){if(f==b||f==null){f=0}d*=e+.01;f+=d;if(d<=c.camera.speed_min)return Math.round(f*100)/100;else return a.fn.f3d.get_distance(c,d,e,f)};a.fn.f3d.get_what=function(b,c,d){switch(d){case"num":return c;break;case"obj":return b.slides[c];break;case"el":return b.slides[c].slide;break;case"slide":return a(b.slides[c].slide);break;case"waiting":return b.camera.z-b.camera.z_min;break;case"distance":return Math.ceil(Math.abs(a.fn.f3d.get_what(b,c,"z")-b.camera.z));break;case"distance_signed":return Math.ceil(a.fn.f3d.get_what(b,c,"z")-b.camera.z);break;case"z_min":case"z_max":var e=null;for(var f in b.slides){if(e==null||d=="z_min"&&e.z>b.slides[f].z||d=="z_max"&&e.z<b.slides[f].z)e=b.slides[f]}return e;break;case"camera_next":return Math.ceil(b.camera.z+b.camera.speed*b.camera.dir*b.camera.dir_change);break;default:return b.slides[c][d];break}};a.fn.f3d.get_prev=function(b,c,d){var e=c-b.camera.dir;if(e<0)e=b.total_slides-1;else if(e>=b.total_slides)e=0;return a.fn.f3d.get_what(b,e,d)};a.fn.f3d.get_next=function(b,c,d){var e=c+b.camera.dir;if(e<0)e=b.total_slides-1;else if(e>=b.total_slides)e=0;return a.fn.f3d.get_what(b,e,d)};a.fn.f3d.get_ran=function(a,b,c){var d=a+Math.random()*(b-a);return typeof c=="undefined"?Math.round(d):d.toFixed(c)};a.fn.f3d.get_url=function(a){a=a.replace('url("',"");a=a.replace("url(","");a=a.replace('")',"");a=a.replace(")","");return a};a.fn.f3d.get_add=function(b,c){var d=null;var e=true;switch(c){case"bg_top":d=a('<div class="f3d_bg_top f3d_added"></div>');d.css({position:"absolute",width:"100%",top:"1px",left:0});break;case"bg_active":var f=b.useBackgroundText?"f3d_bg_active":"f3d_bg_active_notext";d=a('<div class="'+f+' f3d_added"></div>');d.css({position:"absolute",width:"100%",height:"100%",top:0,left:0});break;case"bg_static":d=a('<div class="f3d_bg_static f3d_added"></div>');d.css({position:"absolute",width:"100%",height:"100%",top:0,left:0});break;case"clickables":d=a('<div id="f3d_clickables" class="f3d_added"></div>');d.css({width:b.cont_w+"px",height:b.cont_h+"px",left:0,top:0});break;case"shadow":d=a.fn.f3d.get_shadow(b);a("body").append(d);d.css({left:b.cont_x+"px",top:b.cont_y+b.cont_h-b.shadow_h/2+"px",width:b.cont_w+"px",height:b.shadow_h+"px","z-index":"-1"});var g=0;d.children().each(function(c){if(c==1)var d=b.cont_w-2*b.shadow_w;else var d=b.shadow_w;a(this).css({left:g+"px",width:d+"px",height:b.shadow_h+"px"});g+=d});e=false;break;case"logo":d=a('<img class="f3d_added" src="'+b.useLogo+'" />');if(d.length>0){d.css({position:"absolute",border:"none",left:(b.cont_w-a.fn.f3d.get_elem(d[0],"w"))/2+"px",top:0})}break;case"info":d=a('<div id="info" class="f3d_added"></div>');d.css({position:"absolute",top:0,left:0,width:"50%",color:"#FFCC00","line-height":"1em","z-index":999});break;case"version":d=a('<ul id="f3d_version" class="f3d_added"></ul>');a("body").append(d);d.append("<li>"+b.version+"</li>");d.append("<li>Latest<br/>version</li>");d.css({position:"absolute",left:b.cont_x+b.cont_w-a.fn.f3d.get_elem(d[0],"w")+"px",top:b.cont_y+b.cont_h-a.fn.f3d.get_elem(d[0],"h")-1+"px"});e=false;break}if(d){b[c]=d[0];if(e)b.$cont.append(d)}b["$"+c]=d;return d};a.fn.f3d.get_shadow=function(a){var b=jQuery('<div class="f3d_added" style="position:absolute; overflow:hidden"></div>');b.append('<img src="'+a.path+'f3d_shadow_l.png" />');b.append('<img src="'+a.path+'f3d_shadow_m.png" />');b.append('<img src="'+a.path+'f3d_shadow_r.png" />');b.children().each(function(a){jQuery(this).css({position:"absolute"})});return b};a.fn.f3d.thumb_load=function(b,c,d){var e=a(c.img);var f;if(e.is("iframe")){var g="";var h="";var i=e.attr("src");f=a("<img/>");c.thumb=f;f.appendTo(b.toolimg);b.thumbs.push(f);if(i.indexOf("youtube.com")>-1){g=i.split("embed/")[1].split("?")[0];h="http://img.youtube.com/vi/"+g+"/0.jpg";f.attr("src",h);f.unbind("load");f.bind("load",function(){a.fn.f3d.thumb_size(b,c,d)})}else if(i.indexOf("vimeo.com")>-1){g=i.split("video/")[1].split("?")[0];jQuery.getJSON("http://www.vimeo.com/api/v2/video/"+g+".json?callback=?",{format:"json"},function(e){h=e[0].thumbnail_medium;f.attr("src",h);f.unbind("load");f.bind("load",function(){a.fn.f3d.thumb_size(b,c,d)})})}}else{f=a(c.img).clone();f.appendTo(b.toolimg);c.thumb=f;b.thumbs.push(f);a.fn.f3d.thumb_size(b,c,d)}};a.fn.f3d.thumb_size=function(b,c,d){var e=1;var f=c.img_w;var g=c.img_h;var h=a(c.thumb);if(a(c.img).is("iframe")){f=a.fn.f3d.get_elem(h[0],"w");g=a.fn.f3d.get_elem(h[0],"h")}if(g<f)e=b.toolimg_h/g;else e=b.toolimg_w/f;c.thumb_w=Math.ceil(f*e);c.thumb_h=Math.ceil(g*e);h.css({position:"absolute",width:c.thumb_w+"px",height:c.thumb_h+"px",left:(b.toolimg_w-c.thumb_w)/2+"px"});if(d==b.curr)b.curr_thumb=d;else h.css({top:"-999px",left:"-999px"})}})(jQuery);jQuery.extend(jQuery.easing,{def:"easeOutExpo",swing:function(a,b,c,d,e){return jQuery.easing[jQuery.easing.def](a,b,c,d,e)},easeInExpo:function(a,b,c,d,e){return b==0?c:d*Math.pow(2,10*(b/e-1))+c},easeOutExpo:function(a,b,c,d,e){return b==e?c+d:d*(-Math.pow(2,-10*b/e)+1)+c},easeInOutExpo:function(a,b,c,d,e){if(b==0)return c;if(b==e)return c+d;if((b/=e/2)<1)return d/2*Math.pow(2,10*(b-1))+c;return d/2*(-Math.pow(2,-10*--b)+2)+c}})